(()=>{"use strict";const e="http://localhost:5000/",t=e+"api/authenticate",n=e+"auth/logout",a=e+"auth/refresh_token",i=e+"graphql",o=e+"api/tree/",r=new class{async login(e,t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!n.ok)throw n}async logout(e){const t=await fetch(e,{method:"POST",credentials:"include"});if(!t.ok)throw t}async refreshToken(e){const t=this.getCookie("csrf_refresh_token"),n=await fetch(e,{method:"POST",credentials:"include",headers:{"X-CSRF-TOKEN-REFRESH":t}});if(!n.ok)throw n}async getRestData(e){const t=await fetch(e,{method:"GET",credentials:"include"});if(!t.ok)throw t;return await t.text()}async getGraphQLData(e,t){const n=this.getCookie("csrf_access_token"),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN-ACCESS":n},body:JSON.stringify({query:t}),credentials:"include"});if(!a.ok)throw a;return await a.json()}getCookie(e){let t=null;if(document.cookie&&""!==document.cookie){const n=document.cookie.split(";");for(let a=0;a<n.length;a++){const i=n[a].trim();if(i.substring(0,e.length+1)===e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}},s=new class{constructor(e,t,n,a,i,o){this.loginUrl=e,this.logoutUrl=n,this.refreshUrl=t,this.memberspace_tokenName=a,this.redirectPage=i,this.apiClient=o}async handleGraphQLError(e,t,n){try{if(this.isUnauthorizedError(e))return await this.handleUnauthorizedError(e),await this.apiClient.getGraphQLData(t,n);throw this.isSigFailure(e)&&console.log("Signature failure error"),await this.handleLogout(),e}catch(e){throw e}}async handleRestError(e,t){try{if(this.isUnauthorizedError(e))return await this.handleUnauthorizedError(e),await this.apiClient.getRestData(t);throw this.isSigFailure(e)&&console.log("Signature failure error"),await this.handleLogout(),e}catch(e){throw e}}async handleUnauthorizedError(e){const t=await e.json();if("Token has expired"===t.msg)await this.handleRefresh();else{if('Missing cookie "access_token_cookie"'!==t.msg)throw e;{const e=await async function(){var e={email:"ben.anandappa@gmail.com",user_id:"5130204"};try{await new Promise(((e,t)=>{let n=0;const a=setInterval((()=>{"undefined"!=typeof MemberSpace?(clearInterval(a),e()):(n+=100,n>=1e4&&(clearInterval(a),t("MemberSpace did not become available within the maximum wait time.")))}),100)}));const t=await new Promise(((e,t)=>{if(MemberSpace.ready)try{e(window.MemberSpace.getMemberInfo())}catch(e){t("Error fetching MemberSpace member info: "+e)}else{const n=({detail:a})=>{try{e(a)}catch(e){t("Error in MemberSpace.ready event: "+e)}document.removeEventListener("MemberSpace.ready",n)};document.addEventListener("MemberSpace.ready",n)}}));t&&t.isLoggedIn&&(e.email=t.memberInfo.email,e.user_id=t.memberInfo.id)}catch(e){console.log(`Error with MemberSpace: ${e}`)}return e}();await this.apiClient.login(this.loginUrl,e)}}}async handleRefresh(){try{await this.apiClient.refreshToken(this.refreshUrl)}catch(e){throw this.handleLogout(),e}}async handleLogout(){localStorage.removeItem(this.memberspace_tokenName),await this.apiClient.logout(this.logoutUrl),window.location.href=this.redirectPage}isUnauthorizedError(e){return e instanceof Response&&401===e.status}isSigFailure(e){return e instanceof Response&&422===e.status}}(t,a,n,"MemberSpaceWidget.token","/account",r);function c(e,t,n){const a=t.querySelectorAll(":scope > li"),i=a[a.length-1],o=i.getBoundingClientRect().height/2,r=i.getBoundingClientRect(),s=e.getBoundingClientRect(),l=r.bottom-s.bottom-o;t.style.setProperty("--ul-before-margin",`${l}px`);const d=t.parentElement;n&d&"UL"===d.tagName&&c(d.previousElementSibling,d,!0)}function l(e){for(var t=e.getElementsByClassName("nested"),n=0;n<t.length;n++)t[n].classList.remove("active"),l(t[n]);var a=e.getElementsByClassName("collapsible");for(n=0;n<a.length;n++)a[n].classList.remove("active")}function d(e){e.classList.toggle("active");const t=e.parentElement.parentElement.parentElement,n=t.nextElementSibling;n.classList.toggle("active"),c(t,n,!0),e.classList.contains("active")?e.textContent="":(e.textContent="",l(n))}var u=!1;async function h(e){try{const t=await async function(e){var t=o+e;try{return await r.getRestData(t)}catch(e){return await s.handleRestError(e,t)}}(e);document.getElementById("tree-content").innerHTML=t,function(){u=!1,document.getElementsByClassName("root")[0];var e=document.getElementsByClassName("level-0")[0];e&&c(e.previousElementSibling,e,!1);var t,n=document.getElementsByClassName("collapsible");for(t=0;t<n.length;t++)n[t].addEventListener("click",(function(){d(this)}));var a=document.querySelector(".sticky-bar"),i=.5*window.innerHeight;window.addEventListener("scroll",(function(){window.pageYOffset>i?a.classList.remove("bar-hidden"):a.classList.add("bar-hidden")}));const o=function(e,t){let n;return function(){const t=this,a=arguments;clearTimeout(n),n=setTimeout((function(){n=null,e.apply(t,a)}),10)}}((function(){console.log("Window resized:",window.innerWidth,window.innerHeight);for(var e=document.querySelectorAll(".nested.active"),t=0;t<e.length;t++){var n=e[t];c(n.previousElementSibling,n,!1)}}));window.addEventListener("resize",o)}(),console.log("finsh run tree code"),document.querySelectorAll(".tree-link").forEach((function(e){e.addEventListener("click",(function(){h(this.dataset.treeId)}))}))}catch(e){throw console.error("Error:",e),e}}async function m(){const e=document.getElementById("search-input"),t=document.getElementById("dropdown"),n=document.getElementById("selected-id");document.getElementById("activate_all").addEventListener("click",(function(){!function(){document.getElementsByClassName("root")[0];for(var e=document.getElementsByClassName("level-0")[0],t=document.getElementsByClassName("nested"),n=0;n<t.length;n++){var a=t[n];u?a.classList.contains("level-0")||a.classList.remove("active"):a.classList.add("active")}if(u)c(e.previousElementSibling,e,!1);else for(n=0;n<t.length;n++)c((a=t[n]).previousElementSibling,a,!1);var i=document.getElementsByClassName("collapsible");for(n=0;n<i.length;n++){var o=i[n];u?o.classList.remove("active"):o.classList.add("active")}u=!u}()})),console.log("Hi");try{await h("I0001");const a=await async function(){return(await async function(){try{return await async function(e){try{return await r.getGraphQLData(i,e)}catch(t){return await s.handleGraphQLError(t,i,e)}}("\n      {\n      individuals {\n        id\n        GIVN\n        SURN\n      }\n    }\n    ")}catch(e){throw e}}()).data.individuals.sort(((e,t)=>function(e,t){const n=e.GIVN?e.GIVN.toLowerCase():"",a=t.GIVN?t.GIVN.toLowerCase():"",i=e.SURN?e.SURN.toLowerCase():"",o=t.SURN?t.SURN.toLowerCase():"";return n===a?i.localeCompare(o):n.localeCompare(a)}(e,t)))}();e.addEventListener("input",(()=>function(e,t,n,a){const i=e.value.toLowerCase();t.innerHTML="";!function(e,t,n,a,i){1===a.length&&`${a[0].GIVN} ${a[0].SURN}`.toLowerCase()===i&&n.value!=a[0].id?(n.value=a[0].id,e.value=`${a[0].GIVN} ${a[0].SURN} (${a[0].id})`,t.style.display="none",h(a[0].id)):i.length>1?function(e,t,n,a){a.forEach((a=>{let i=document.createElement("div");i.textContent=`${a.GIVN} ${a.SURN} (${a.id})`,i.onclick=()=>function(e,t,n,a){t.value=`${e.GIVN} ${e.SURN} (${e.id})`,n.value=e.id,a.innerHTML="",a.style.display="none",h(e.id)}(a,t,n,e),e.appendChild(i)})),e.style.display="block"}(t,e,n,a):t.style.display="none"}(e,t,n,a.filter((e=>`${e.GIVN} ${e.SURN}`.toLowerCase().includes(i))),i)}(e,t,n,a))),e.addEventListener("blur",(()=>function(e){setTimeout((()=>{e.contains(document.activeElement)||(e.style.display="none")}),200)}(t)))}catch(e){}}document.addEventListener("DOMContentLoaded",(async function(){await m()})),document.addEventListener("MemberSpace.member.info",m)})();
//# sourceMappingURL=dynamic_tree.js.map